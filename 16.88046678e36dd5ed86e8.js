(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{NZL8:function(t,e,n){"use strict";n.r(e),n.d(e,"SettingsModule",function(){return E});var s=n("M0ag"),i=n("fXoL"),r=n("Ac7g"),o=n("PScX"),a=n("Wfee"),c=n("3Pt+"),l=n("ocnv"),b=n("O3k0"),d=n("PTRe"),m=n("OzZK"),h=n("RwU8"),u=n("C2AL"),g=n("ofXK");function p(t,e){if(1&t){const t=i.Xb();i.Wb(0,"span"),i.Kc(1," \u60a8\u7684\u90ae\u7bb1\u6682\u672a\u6fc0\u6d3b\uff0c\u5fd8\u8bb0\u5bc6\u7801\u5c06\u65e0\u6cd5\u627e\u56de\u8d26\u6237\uff0c\u8bf7\u70b9\u51fb "),i.Wb(2,"a",13),i.dc("click",function(){return i.Ac(t),i.gc(2).sendEmail()}),i.Kc(3,"\u6fc0\u6d3b"),i.Vb(),i.Kc(4," \u6211\u4eec\u5c06\u7ed9\u60a8\u7684\u90ae\u7bb1\u53d1\u9001\u6fc0\u6d3b\u90ae\u4ef6\u3002 "),i.Vb()}}function f(t,e){1&t&&(i.Wb(0,"span"),i.Kc(1,"\u60a8\u7684\u90ae\u7bb1\u5df2\u6fc0\u6d3b"),i.Vb())}function C(t,e){if(1&t&&(i.Ic(0,p,5,0,"span",12),i.Ic(1,f,2,0,"span",12)),2&t){const t=i.gc();i.oc("ngIf","unactivated"===t.form.status),i.Cb(1),i.oc("ngIf","active"===t.form.status)}}let z=(()=>{class t{constructor(t,e,n,s,i){this.http=t,this.settings=e,this.titleSrv=n,this.msg=s,this.cdr=i,this.form={username:"",email:"",status:"unactivated",base_currency_code:"CNY"}}ngOnInit(){this.titleSrv.setTitle("\u57fa\u672c\u8bbe\u7f6e"),this.load()}save(t){this.http.post("/api/users/me",t).subscribe(t=>{0===t.code?(this.settings.setUser({name:t.data.username,email:t.data.email,avatar:t.data.avatar}),this.form=t.data,this.msg.success("\u66f4\u65b0\u6210\u529f")):this.msg.warning(t.message)})}sendEmail(){this.http.post("/api/users/send-confirmation").subscribe(t=>{0===t.code?(this.form.status="",this.cdr.detectChanges(),this.msg.success(t.data)):this.msg.warning(t.message)})}load(){this.http.get("/api/users/me").subscribe(t=>{0===t.code?(this.form=t.data,this.cdr.detectChanges()):this.msg.warning(t.message)})}}return t.\u0275fac=function(e){return new(e||t)(i.Qb(r.p),i.Qb(r.l),i.Qb(r.m),i.Qb(o.e),i.Qb(i.h))},t.\u0275cmp=i.Kb({type:t,selectors:[["app-settings-base"]],decls:14,vars:5,consts:[["nzType","warning","nzMessage","\u6ce8\u610f\uff01\u66f4\u65b0\u90ae\u7bb1\u9700\u8981\u91cd\u65b0\u6fc0\u6d3b"],["nz-form","","se-container","1","labelWidth","100",1,"pt-lg",3,"ngSubmit"],["f","ngForm"],["label","\u7528\u6237\u540d"],["type","text","nz-input","","name","username","required","","maxlength","32",3,"ngModel","ngModelChange"],["label","\u90ae\u7bb1",3,"extra"],["type","text","nz-input","","name","email","required","","maxlength","120",3,"ngModel","ngModelChange"],["extra",""],["label","\u57fa\u7840\u8d27\u5e01"],["type","text","nz-input","","name","base_currency_code","disabled","",3,"ngModel","ngModelChange"],["col","1"],["nz-button","","nzType","primary",3,"disabled"],[4,"ngIf"],[3,"click"]],template:function(t,e){if(1&t&&(i.Rb(0,"nz-alert",0),i.Wb(1,"form",1,2),i.dc("ngSubmit",function(){return e.save(e.form)}),i.Wb(3,"se",3),i.Wb(4,"input",4),i.dc("ngModelChange",function(t){return e.form.username=t}),i.Vb(),i.Vb(),i.Wb(5,"se",5),i.Wb(6,"input",6),i.dc("ngModelChange",function(t){return e.form.email=t}),i.Vb(),i.Ic(7,C,2,2,"ng-template",null,7,i.Jc),i.Vb(),i.Wb(9,"se",8),i.Wb(10,"input",9),i.dc("ngModelChange",function(t){return e.form.base_currency_code=t}),i.Vb(),i.Vb(),i.Wb(11,"se",10),i.Wb(12,"button",11),i.Kc(13,"\u4fdd\u5b58"),i.Vb(),i.Vb(),i.Vb()),2&t){const t=i.xc(2),n=i.xc(8);i.Cb(4),i.oc("ngModel",e.form.username),i.Cb(1),i.oc("extra",n),i.Cb(1),i.oc("ngModel",e.form.email),i.Cb(4),i.oc("ngModel",e.form.base_currency_code),i.Cb(2),i.oc("disabled",t.invalid)}},directives:[a.a,c.u,c.n,c.o,l.b,b.b,b.a,d.b,c.d,c.s,c.j,c.m,c.p,m.a,h.a,u.a,g.o],encapsulation:2,changeDetection:0}),t})();var v=n("dEAy"),w=n("Ff2k"),y=n("FwiY");function _(t,e){if(1&t){const t=i.Xb();i.Wb(0,"a",6),i.dc("click",function(){return i.Ac(t),i.gc().bindTelegram()}),i.Kc(1,"\u4fee\u6539"),i.Vb()}}function M(t,e){1&t&&i.Rb(0,"i",7)}function W(t,e){1&t&&(i.Wb(0,"div"),i.Kc(1,"\u5f53\u524d\u672a\u7ed1\u5b9a Telegram \u8d26\u53f7"),i.Vb())}function k(t,e){if(1&t&&(i.Wb(0,"div"),i.Kc(1," \u5f53\u524d\u7ed1\u5b9a\u7684 Telegram \u8d26\u53f7 "),i.Wb(2,"a",9),i.Kc(3),i.Vb(),i.Vb()),2&t){const t=i.gc(2);i.Cb(2),i.qc("href","https://t.me/",null==t.telegram?null:t.telegram.client_username,"",i.Cc),i.Cb(1),i.Mc("@",null==t.telegram?null:t.telegram.client_username,"")}}function V(t,e){if(1&t&&(i.Ic(0,W,2,0,"div",8),i.Ic(1,k,4,2,"div",8)),2&t){const t=i.gc();i.oc("ngIf",!t.telegram),i.Cb(1),i.oc("ngIf",t.telegram)}}const x=function(t){return[t]};let O=(()=>{class t{constructor(t,e,n,s,i,r){this.http=t,this.msg=e,this.modal=n,this.cdr=s,this.titleSrv=i,this.settings=r,this.telegram={client_username:""}}ngOnInit(){this.titleSrv.setTitle("\u8d26\u53f7\u7ed1\u5b9a"),this.getData()}getData(){this.http.get("/api/users/auth-clients").subscribe(t=>{var e;this.telegram=null===(e=t.data)||void 0===e?void 0:e.telegram,this.cdr.detectChanges()})}bindTelegram(){const t=this.settings.app.telegram_bot_name;this.http.post("/api/reset-token").subscribe(e=>{this.modal.info({nzWidth:"500px",nzTitle:"\u7ed1\u5b9a Telegram \u8d26\u53f7",nzContent:`\u5c06\u4e0b\u9762\u7684\u7ed1\u5b9a\u7801\u590d\u5236\u53d1\u9001\u7ed9 Telegram \u673a\u5668\u4eba <a href="https://t.me/${t}" target="_blank">@${t}</a> </br> <code>/bind/${e.data.reset_token}</code>`,nzOnOk:()=>this.getData()})})}}return t.\u0275fac=function(e){return new(e||t)(i.Qb(r.p),i.Qb(o.e),i.Qb(v.c),i.Qb(i.h),i.Qb(r.m),i.Qb(r.l))},t.\u0275cmp=i.Kb({type:t,selectors:[["app-settings-binding"]],decls:9,vars:5,consts:[["nzItemLayout","horizontal"],[3,"nzActions"],["telegramOp",""],["nzTitle","\u7ed1\u5b9a Telegram",3,"nzAvatar","nzDescription"],["telegramAvatar",""],["telegramDescription",""],[3,"click"],["nz-icon","","nzIconfont","icon-telegram",1,"icon-sm"],[4,"ngIf"],["target","_blank",3,"href"]],template:function(t,e){if(1&t&&(i.Wb(0,"nz-list",0),i.Wb(1,"nz-list-item",1),i.Ic(2,_,2,0,"ng-template",null,2,i.Jc),i.Wb(4,"nz-list-item-meta",3),i.Ic(5,M,1,0,"ng-template",null,4,i.Jc),i.Ic(7,V,2,2,"ng-template",null,5,i.Jc),i.Vb(),i.Vb(),i.Vb()),2&t){const t=i.xc(3),e=i.xc(6),n=i.xc(8);i.Cb(1),i.oc("nzActions",i.sc(3,x,t)),i.Cb(3),i.oc("nzAvatar",e)("nzDescription",n)}},directives:[w.a,w.c,w.d,u.a,y.a,g.o],encapsulation:2,changeDetection:0}),t})();var Q=n("0bRG"),I=n("tyNb");let S=(()=>{class t{constructor(t,e,n,s,i,r){this.http=e,this.titleSrv=n,this.msg=s,this.router=i,this.tokenService=r,this.form=t.group({old_password:[null,[c.t.required]],new_password:[null,[c.t.required,c.t.minLength(6)]],retype_password:[null,[c.t.required,c.t.minLength(6)]]},{validator:this.matchingPasswords("new_password","retype_password")})}ngOnInit(){this.titleSrv.setTitle("\u4fee\u6539\u5bc6\u7801")}matchingPasswords(t,e){return n=>{const s=n.controls[e];if(n.controls[t].value!==s.value)return s.setErrors({notEquivalent:!0})}}save(){this.http.post("/api/users/change-password",this.form.value).subscribe(t=>{0===t.code?(this.tokenService.clear(),this.router.navigateByUrl(this.tokenService.login_url)):this.msg.warning(t.message)})}}return t.\u0275fac=function(e){return new(e||t)(i.Qb(c.e),i.Qb(r.p),i.Qb(r.m),i.Qb(o.e),i.Qb(I.k),i.Qb(Q.a))},t.\u0275cmp=i.Kb({type:t,selectors:[["app-settings-password"]],decls:11,vars:2,consts:[["nzType","warning","nzMessage","\u6ce8\u610f\uff01\u66f4\u65b0\u5bc6\u7801\u4ee5\u540e\u9700\u8981\u91cd\u65b0\u767b\u5f55"],["nz-form","","se-container","1","labelWidth","100",1,"pt-lg",3,"formGroup","ngSubmit"],["label","\u65e7\u5bc6\u7801"],["type","password","nz-input","","formControlName","old_password"],["label","\u65b0\u5bc6\u7801","error","\u5bc6\u7801\u81f3\u5c116\u4f4d\u6570"],["type","password","nz-input","","formControlName","new_password"],["label","\u786e\u8ba4\u5bc6\u7801","error","\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4"],["type","password","nz-input","","formControlName","retype_password"],["col","1"],["nz-button","","nzType","primary",3,"disabled"]],template:function(t,e){1&t&&(i.Rb(0,"nz-alert",0),i.Wb(1,"form",1),i.dc("ngSubmit",function(){return e.save()}),i.Wb(2,"se",2),i.Rb(3,"input",3),i.Vb(),i.Wb(4,"se",4),i.Rb(5,"input",5),i.Vb(),i.Wb(6,"se",6),i.Rb(7,"input",7),i.Vb(),i.Wb(8,"se",8),i.Wb(9,"button",9),i.Kc(10,"\u4fdd\u5b58"),i.Vb(),i.Vb(),i.Vb()),2&t&&(i.Cb(1),i.oc("formGroup",e.form),i.Cb(8),i.oc("disabled",e.form.invalid))},directives:[a.a,c.u,c.n,l.b,b.b,c.h,b.a,d.b,c.d,c.m,c.g,m.a,h.a,u.a],encapsulation:2,changeDetection:0}),t})();var P=n("xgIS"),T=n("pLZG"),K=n("Kj3r"),A=n("Q8cG");function D(t,e){if(1&t){const t=i.Xb();i.Wb(0,"li",6),i.dc("click",function(){i.Ac(t);const n=e.$implicit;return i.gc().to(n)}),i.Kc(1),i.Vb()}if(2&t){const t=e.$implicit;i.oc("nzSelected",t.selected),i.Cb(1),i.Lc(t.title)}}let R=(()=>{class t{constructor(t,e,n){this.router=t,this.cdr=e,this.el=n,this.mode="inline",this.menus=[{key:"base",title:"\u57fa\u672c\u8bbe\u7f6e"},{key:"password",title:"\u4fee\u6539\u5bc6\u7801"},{key:"binding",title:"\u8d26\u53f7\u7ed1\u5b9a"},{key:"report",title:"\u8bbe\u7f6e\u62a5\u544a"}],this.router$=this.router.events.pipe(Object(T.a)(t=>t instanceof I.b)).subscribe(()=>this.setActive())}setActive(){const t=this.router.url.substr(this.router.url.lastIndexOf("/")+1);this.menus.forEach(e=>{e.selected=e.key===t}),this.title=this.menus.find(t=>t.selected).title}to(t){this.router.navigateByUrl(`/settings/personal/${t.key}`)}resize(){const t=this.el.nativeElement;let e="inline";const{offsetWidth:n}=t;n<641&&n>400&&(e="horizontal"),window.innerWidth<768&&n>400&&(e="horizontal"),this.mode=e,this.cdr.detectChanges()}ngAfterViewInit(){this.resize$=Object(P.a)(window,"resize").pipe(Object(K.a)(200)).subscribe(()=>this.resize())}ngOnDestroy(){this.resize$.unsubscribe(),this.router$.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(i.Qb(I.k),i.Qb(i.h),i.Qb(i.l))},t.\u0275cmp=i.Kb({type:t,selectors:[["app-settings-personal"]],decls:8,vars:3,consts:[[1,"main","ant-card-bordered"],[1,"menu"],["nz-menu","",3,"nzMode"],["nz-menu-item","",3,"nzSelected","click",4,"ngFor","ngForOf"],[1,"content"],[1,"title"],["nz-menu-item","",3,"nzSelected","click"]],template:function(t,e){1&t&&(i.Wb(0,"div",0),i.Wb(1,"div",1),i.Wb(2,"ul",2),i.Ic(3,D,2,2,"li",3),i.Vb(),i.Vb(),i.Wb(4,"div",4),i.Wb(5,"div",5),i.Kc(6),i.Vb(),i.Rb(7,"router-outlet"),i.Vb(),i.Vb()),2&t&&(i.Cb(2),i.oc("nzMode",e.mode),i.Cb(1),i.oc("ngForOf",e.menus),i.Cb(3),i.Lc(e.title))},directives:[A.c,g.n,I.o,u.a,A.e],styles:["[_nghost-%COMP%]{display:block;padding-top:24px}[_nghost-%COMP%]     .main{display:flex;width:100%;padding-top:16px;padding-bottom:16px;overflow:auto;background-color:#fff}[_nghost-%COMP%]     .menu{width:224px;border-right:1px solid #f0f0f0}[_nghost-%COMP%]     .menu .ant-menu-inline{border:none}[_nghost-%COMP%]     .menu .ant-menu:not(.ant-menu-horizontal) .ant-menu-item-selected{font-weight:700}[_nghost-%COMP%]     .content{flex:1;padding:8px 40px}[_nghost-%COMP%]     .content .title{margin-bottom:12px;color:#000000d9;font-weight:500;font-size:20px;line-height:28px}[_nghost-%COMP%]     .content .ant-list-split .ant-list-item:last-child{border-bottom:1px solid #e8e8e8}[_nghost-%COMP%]     .content .ant-list-item{padding-top:14px;padding-bottom:14px}@media screen and (max-width:767px){[_nghost-%COMP%]     .main{flex-direction:column}[_nghost-%COMP%]     .main .menu{width:100%;border:none}[_nghost-%COMP%]     .main .content{padding:40px}}[data-theme=dark]   [_nghost-%COMP%]     .main{background-color:#141414}[data-theme=dark]   [_nghost-%COMP%]     .content .title{color:#ffffffa6}[data-theme=dark]   [_nghost-%COMP%]     .menu{border-right-color:#303030}[data-theme=dark]   [_nghost-%COMP%]     .content .ant-list-split .ant-list-item:last-child{border-bottom-color:#303030}"],changeDetection:0}),t})();var $=n("EGpF");const L=[{path:"personal",component:R,children:[{path:"",redirectTo:"base",pathMatch:"full"},{path:"base",component:z},{path:"binding",component:O},{path:"password",component:S},{path:"report",component:(()=>{class t{constructor(t,e,n,s){this.http=t,this.titleSrv=e,this.msg=n,this.cdr=s,this.url="/api/users/settings",this.form={daily_report:!1,weekly_report:!1,monthly_report:!1}}ngOnInit(){this.titleSrv.setTitle("\u8bbe\u7f6e\u62a5\u544a"),this.load()}save(t){this.http.post(this.url,Object.assign({},t)).subscribe(t=>{0===t.code?(this.form=t.data,this.msg.success("\u66f4\u65b0\u6210\u529f")):this.msg.warning(t.message)})}load(){this.http.get(this.url).subscribe(t=>{0===t.code?(this.form=t.data,this.cdr.detectChanges()):this.msg.warning(t.message)})}}return t.\u0275fac=function(e){return new(e||t)(i.Qb(r.p),i.Qb(r.m),i.Qb(o.e),i.Qb(i.h))},t.\u0275cmp=i.Kb({type:t,selectors:[["app-settings-report"]],decls:12,vars:4,consts:[["nzType","warning","nzMessage","\u6ce8\u610f\uff01\u6b64\u529f\u80fd\u53ea\u4e3a Pro \u5e76\u4e14\u5df2\u7ecf\u7ed1\u5b9a Telegram \u7684\u7528\u6237\u4f7f\u7528"],["nz-form","","se-container","1","labelWidth","100",1,"pt-lg",3,"ngSubmit"],["f","ngForm"],["label","\u65e5\u62a5","extra","\u6bcf\u5929\u65e9\u4e0a 10 \u70b9\u62a5\u544a\u6628\u65e5\u6d88\u8d39\u6c47\u603b"],["nzCheckedChildren","\u5f00","nzUnCheckedChildren","\u5173","name","daily_report",3,"ngModel","ngModelChange"],["label","\u5468\u62a5","extra","\u6bcf\u5468\u4e00\u65e9\u4e0a 10 \u70b9\u62a5\u544a\u4e0a\u5468\u6d88\u8d39\u6c47\u603b"],["nzCheckedChildren","\u5f00","nzUnCheckedChildren","\u5173","name","weekly_report",3,"ngModel","ngModelChange"],["label","\u6708\u62a5","extra","\u6bcf\u6708 1 \u53f7\u65e9\u4e0a 10 \u70b9\u62a5\u544a\u4e0a\u4e2a\u6708\u6d88\u8d39\u6c47\u603b"],["nzCheckedChildren","\u5f00","nzUnCheckedChildren","\u5173","name","monthly_report",3,"ngModel","ngModelChange"],["col","1"],["nz-button","","nzType","primary",3,"disabled"]],template:function(t,e){if(1&t&&(i.Rb(0,"nz-alert",0),i.Wb(1,"form",1,2),i.dc("ngSubmit",function(){return e.save(e.form)}),i.Wb(3,"se",3),i.Wb(4,"nz-switch",4),i.dc("ngModelChange",function(t){return e.form.daily_report=t}),i.Vb(),i.Vb(),i.Wb(5,"se",5),i.Wb(6,"nz-switch",6),i.dc("ngModelChange",function(t){return e.form.weekly_report=t}),i.Vb(),i.Vb(),i.Wb(7,"se",7),i.Wb(8,"nz-switch",8),i.dc("ngModelChange",function(t){return e.form.monthly_report=t}),i.Vb(),i.Vb(),i.Wb(9,"se",9),i.Wb(10,"button",10),i.Kc(11,"\u4fdd\u5b58"),i.Vb(),i.Vb(),i.Vb()),2&t){const t=i.xc(2);i.Cb(4),i.oc("ngModel",e.form.daily_report),i.Cb(2),i.oc("ngModel",e.form.weekly_report),i.Cb(2),i.oc("ngModel",e.form.monthly_report),i.Cb(2),i.oc("disabled",t.invalid)}},directives:[a.a,c.u,c.n,c.o,l.b,b.b,b.a,$.a,c.m,c.p,m.a,h.a,u.a],encapsulation:2,changeDetection:0}),t})()}]}];let j=(()=>{class t{}return t.\u0275mod=i.Ob({type:t}),t.\u0275inj=i.Nb({factory:function(e){return new(e||t)},imports:[[I.n.forChild(L)],I.n]}),t})(),E=(()=>{class t{}return t.\u0275mod=i.Ob({type:t}),t.\u0275inj=i.Nb({factory:function(e){return new(e||t)},imports:[[s.b,j]]}),t})()}}]);