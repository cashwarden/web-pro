(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{NZL8:function(t,e,n){"use strict";n.r(e),n.d(e,"SettingsModule",function(){return q});var i=n("M0ag"),s=n("fXoL"),o=n("Ac7g"),r=n("PScX"),a=n("Wfee"),c=n("3Pt+"),l=n("ocnv"),b=n("O3k0"),d=n("PTRe"),m=n("OzZK"),u=n("RwU8"),h=n("C2AL"),g=n("ofXK");function p(t,e){if(1&t){const t=s.Xb();s.Wb(0,"span"),s.Lc(1," \u60a8\u7684\u90ae\u7bb1\u6682\u672a\u6fc0\u6d3b\uff0c\u5fd8\u8bb0\u5bc6\u7801\u5c06\u65e0\u6cd5\u627e\u56de\u8d26\u6237\uff0c\u8bf7\u70b9\u51fb "),s.Wb(2,"a",13),s.dc("click",function(){return s.Bc(t),s.gc(2).sendEmail()}),s.Lc(3,"\u6fc0\u6d3b"),s.Vb(),s.Lc(4," \u6211\u4eec\u5c06\u7ed9\u60a8\u7684\u90ae\u7bb1\u53d1\u9001\u6fc0\u6d3b\u90ae\u4ef6\u3002 "),s.Vb()}}function f(t,e){1&t&&(s.Wb(0,"span"),s.Lc(1,"\u60a8\u7684\u90ae\u7bb1\u5df2\u6fc0\u6d3b"),s.Vb())}function z(t,e){if(1&t&&(s.Jc(0,p,5,0,"span",12),s.Jc(1,f,2,0,"span",12)),2&t){const t=s.gc();s.oc("ngIf","unactivated"===t.form.status),s.Cb(1),s.oc("ngIf","active"===t.form.status)}}let C=(()=>{class t{constructor(t,e,n,i,s){this.http=t,this.settings=e,this.titleSrv=n,this.msg=i,this.cdr=s,this.form={username:"",email:"",status:"unactivated",base_currency_code:"CNY"}}ngOnInit(){this.titleSrv.setTitle("\u57fa\u672c\u8bbe\u7f6e"),this.load()}save(t){this.http.post("/api/users/me",t).subscribe(t=>{0===t.code?(this.settings.setUser({name:t.data.username,email:t.data.email,avatar:t.data.avatar}),this.form=t.data,this.msg.success("\u66f4\u65b0\u6210\u529f")):this.msg.warning(t.message)})}sendEmail(){this.http.post("/api/users/send-confirmation").subscribe(t=>{0===t.code?(this.form.status="",this.cdr.detectChanges(),this.msg.success(t.data)):this.msg.warning(t.message)})}load(){this.http.get("/api/users/me").subscribe(t=>{0===t.code?(this.form=t.data,this.cdr.detectChanges()):this.msg.warning(t.message)})}}return t.\u0275fac=function(e){return new(e||t)(s.Qb(o.p),s.Qb(o.l),s.Qb(o.m),s.Qb(r.e),s.Qb(s.h))},t.\u0275cmp=s.Kb({type:t,selectors:[["app-settings-base"]],decls:14,vars:5,consts:[["nzType","warning","nzMessage","\u6ce8\u610f\uff01\u66f4\u65b0\u90ae\u7bb1\u9700\u8981\u91cd\u65b0\u6fc0\u6d3b"],["nz-form","","se-container","1","labelWidth","100",1,"pt-lg",3,"ngSubmit"],["f","ngForm"],["label","\u7528\u6237\u540d"],["type","text","nz-input","","name","username","required","","maxlength","32",3,"ngModel","ngModelChange"],["label","\u90ae\u7bb1",3,"extra"],["type","text","nz-input","","name","email","required","","maxlength","120",3,"ngModel","ngModelChange"],["extra",""],["label","\u57fa\u7840\u8d27\u5e01"],["type","text","nz-input","","name","base_currency_code","disabled","",3,"ngModel","ngModelChange"],["col","1"],["nz-button","","nzType","primary",3,"disabled"],[4,"ngIf"],[3,"click"]],template:function(t,e){if(1&t&&(s.Rb(0,"nz-alert",0),s.Wb(1,"form",1,2),s.dc("ngSubmit",function(){return e.save(e.form)}),s.Wb(3,"se",3),s.Wb(4,"input",4),s.dc("ngModelChange",function(t){return e.form.username=t}),s.Vb(),s.Vb(),s.Wb(5,"se",5),s.Wb(6,"input",6),s.dc("ngModelChange",function(t){return e.form.email=t}),s.Vb(),s.Jc(7,z,2,2,"ng-template",null,7,s.Kc),s.Vb(),s.Wb(9,"se",8),s.Wb(10,"input",9),s.dc("ngModelChange",function(t){return e.form.base_currency_code=t}),s.Vb(),s.Vb(),s.Wb(11,"se",10),s.Wb(12,"button",11),s.Lc(13,"\u4fdd\u5b58"),s.Vb(),s.Vb(),s.Vb()),2&t){const t=s.yc(2),n=s.yc(8);s.Cb(4),s.oc("ngModel",e.form.username),s.Cb(1),s.oc("extra",n),s.Cb(1),s.oc("ngModel",e.form.email),s.Cb(4),s.oc("ngModel",e.form.base_currency_code),s.Cb(2),s.oc("disabled",t.invalid)}},directives:[a.a,c.u,c.n,c.o,l.b,b.b,b.a,d.b,c.d,c.s,c.j,c.m,c.p,m.a,u.a,h.a,g.o],encapsulation:2,changeDetection:0}),t})();var v=n("dEAy"),y=n("Ff2k"),w=n("FwiY"),_=n("KupA");function M(t,e){if(1&t){const t=s.Xb();s.Wb(0,"a",7),s.dc("click",function(){return s.Bc(t),s.gc().bindTelegram()}),s.Rb(1,"i",8),s.Vb()}}function W(t,e){1&t&&(s.Wb(0,"a",11),s.Rb(1,"i",12),s.Vb())}function k(t,e){if(1&t){const t=s.Xb();s.Wb(0,"a",13),s.dc("nzOnConfirm",function(){return s.Bc(t),s.gc(2).deleteTelegram()}),s.Rb(1,"i",12),s.Vb()}}function V(t,e){if(1&t&&(s.Jc(0,W,2,0,"a",9),s.Jc(1,k,2,0,"a",10)),2&t){const t=s.gc();s.oc("ngIf",!t.telegram),s.Cb(1),s.oc("ngIf",t.telegram)}}function O(t,e){1&t&&s.Rb(0,"i",14)}function x(t,e){1&t&&(s.Wb(0,"div"),s.Lc(1,"\u5f53\u524d\u672a\u7ed1\u5b9a Telegram \u8d26\u53f7"),s.Vb())}function P(t,e){if(1&t&&(s.Wb(0,"div"),s.Lc(1," \u5f53\u524d\u7ed1\u5b9a\u7684 Telegram \u8d26\u53f7 "),s.Wb(2,"a",16),s.Lc(3),s.Vb(),s.Vb()),2&t){const t=s.gc(2);s.Cb(2),s.qc("href","https://t.me/",null==t.telegram?null:t.telegram.client_username,"",s.Dc),s.Cb(1),s.Nc("@",null==t.telegram?null:t.telegram.client_username,"")}}function T(t,e){if(1&t&&(s.Jc(0,x,2,0,"div",15),s.Jc(1,P,4,2,"div",15)),2&t){const t=s.gc();s.oc("ngIf",!t.telegram),s.Cb(1),s.oc("ngIf",t.telegram)}}const Q=function(t,e){return[t,e]};let S=(()=>{class t{constructor(t,e,n,i,s,o){this.http=t,this.msg=e,this.modal=n,this.cdr=i,this.titleSrv=s,this.settings=o,this.telegram={client_username:""}}ngOnInit(){this.titleSrv.setTitle("\u8d26\u53f7\u7ed1\u5b9a"),this.getData()}getData(){this.http.get("/api/users/auth-clients").subscribe(t=>{var e;this.telegram=null===(e=t.data)||void 0===e?void 0:e.telegram,this.cdr.detectChanges()})}bindTelegram(){const t=this.settings.app.telegram_bot_name;this.http.post("/api/reset-token").subscribe(e=>{this.modal.info({nzWidth:"500px",nzTitle:"\u7ed1\u5b9a Telegram \u8d26\u53f7",nzContent:`\u5c06\u4e0b\u9762\u7684\u7ed1\u5b9a\u7801\u590d\u5236\u53d1\u9001\u7ed9 Telegram \u673a\u5668\u4eba <a href="https://t.me/${t}" target="_blank">@${t}</a> </br> <code>/bind/${e.data.reset_token}</code>`,nzOnOk:()=>this.getData()})})}deleteTelegram(){this.http.delete("/api/users/auth-client/telegram").subscribe(t=>{0===t.code?(this.telegram=null,this.cdr.detectChanges(),this.msg.success("\u66f4\u65b0\u6210\u529f")):this.msg.warning(t.message)})}}return t.\u0275fac=function(e){return new(e||t)(s.Qb(o.p),s.Qb(r.e),s.Qb(v.c),s.Qb(s.h),s.Qb(o.m),s.Qb(o.l))},t.\u0275cmp=s.Kb({type:t,selectors:[["app-settings-binding"]],decls:11,vars:6,consts:[["nzItemLayout","horizontal"],[3,"nzActions"],["edit",""],["del",""],["nzTitle","\u7ed1\u5b9a Telegram",3,"nzAvatar","nzDescription"],["telegramAvatar",""],["telegramDescription",""],[3,"click"],["nz-icon","","nzType","edit","theme","outline"],["disabled","",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f","nzPopconfirmPlacement","bottom",3,"nzOnConfirm",4,"ngIf"],["disabled",""],["nz-icon","","nzType","delete","theme","outline"],["nz-popconfirm","","nzPopconfirmTitle","\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f","nzPopconfirmPlacement","bottom",3,"nzOnConfirm"],["nz-icon","","nzIconfont","icon-telegram",1,"icon-sm"],[4,"ngIf"],["target","_blank",3,"href"]],template:function(t,e){if(1&t&&(s.Wb(0,"nz-list",0),s.Wb(1,"nz-list-item",1),s.Jc(2,M,2,0,"ng-template",null,2,s.Kc),s.Jc(4,V,2,2,"ng-template",null,3,s.Kc),s.Wb(6,"nz-list-item-meta",4),s.Jc(7,O,1,0,"ng-template",null,5,s.Kc),s.Jc(9,T,2,2,"ng-template",null,6,s.Kc),s.Vb(),s.Vb(),s.Vb()),2&t){const t=s.yc(3),e=s.yc(5),n=s.yc(8),i=s.yc(10);s.Cb(1),s.oc("nzActions",s.tc(3,Q,t,e)),s.Cb(5),s.oc("nzAvatar",n)("nzDescription",i)}},directives:[y.a,y.c,y.d,h.a,w.a,g.o,_.a],encapsulation:2,changeDetection:0}),t})();var I=n("0bRG"),L=n("tyNb");let J=(()=>{class t{constructor(t,e,n,i,s,o){this.http=e,this.titleSrv=n,this.msg=i,this.router=s,this.tokenService=o,this.form=t.group({old_password:[null,[c.t.required]],new_password:[null,[c.t.required,c.t.minLength(6)]],retype_password:[null,[c.t.required,c.t.minLength(6)]]},{validator:this.matchingPasswords("new_password","retype_password")})}ngOnInit(){this.titleSrv.setTitle("\u4fee\u6539\u5bc6\u7801")}matchingPasswords(t,e){return n=>{const i=n.controls[e];if(n.controls[t].value!==i.value)return i.setErrors({notEquivalent:!0})}}save(){this.http.post("/api/users/change-password",this.form.value).subscribe(t=>{0===t.code?(this.tokenService.clear(),this.router.navigateByUrl(this.tokenService.login_url)):this.msg.warning(t.message)})}}return t.\u0275fac=function(e){return new(e||t)(s.Qb(c.e),s.Qb(o.p),s.Qb(o.m),s.Qb(r.e),s.Qb(L.k),s.Qb(I.a))},t.\u0275cmp=s.Kb({type:t,selectors:[["app-settings-password"]],decls:11,vars:2,consts:[["nzType","warning","nzMessage","\u6ce8\u610f\uff01\u66f4\u65b0\u5bc6\u7801\u4ee5\u540e\u9700\u8981\u91cd\u65b0\u767b\u5f55"],["nz-form","","se-container","1","labelWidth","100",1,"pt-lg",3,"formGroup","ngSubmit"],["label","\u65e7\u5bc6\u7801"],["type","password","nz-input","","formControlName","old_password"],["label","\u65b0\u5bc6\u7801","error","\u5bc6\u7801\u81f3\u5c116\u4f4d\u6570"],["type","password","nz-input","","formControlName","new_password"],["label","\u786e\u8ba4\u5bc6\u7801","error","\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4"],["type","password","nz-input","","formControlName","retype_password"],["col","1"],["nz-button","","nzType","primary",3,"disabled"]],template:function(t,e){1&t&&(s.Rb(0,"nz-alert",0),s.Wb(1,"form",1),s.dc("ngSubmit",function(){return e.save()}),s.Wb(2,"se",2),s.Rb(3,"input",3),s.Vb(),s.Wb(4,"se",4),s.Rb(5,"input",5),s.Vb(),s.Wb(6,"se",6),s.Rb(7,"input",7),s.Vb(),s.Wb(8,"se",8),s.Wb(9,"button",9),s.Lc(10,"\u4fdd\u5b58"),s.Vb(),s.Vb(),s.Vb()),2&t&&(s.Cb(1),s.oc("formGroup",e.form),s.Cb(8),s.oc("disabled",e.form.invalid))},directives:[a.a,c.u,c.n,l.b,b.b,c.h,b.a,d.b,c.d,c.m,c.g,m.a,u.a,h.a],encapsulation:2,changeDetection:0}),t})();var K=n("xgIS"),R=n("pLZG"),D=n("Kj3r"),A=n("Q8cG");function $(t,e){if(1&t){const t=s.Xb();s.Wb(0,"li",6),s.dc("click",function(){s.Bc(t);const n=e.$implicit;return s.gc().to(n)}),s.Lc(1),s.Vb()}if(2&t){const t=e.$implicit;s.oc("nzSelected",t.selected),s.Cb(1),s.Mc(t.title)}}let N=(()=>{class t{constructor(t,e,n){this.router=t,this.cdr=e,this.el=n,this.mode="inline",this.menus=[{key:"base",title:"\u57fa\u672c\u8bbe\u7f6e"},{key:"password",title:"\u4fee\u6539\u5bc6\u7801"},{key:"binding",title:"\u8d26\u53f7\u7ed1\u5b9a"},{key:"report",title:"\u8bbe\u7f6e\u62a5\u544a"}],this.router$=this.router.events.pipe(Object(R.a)(t=>t instanceof L.b)).subscribe(()=>this.setActive())}setActive(){const t=this.router.url.substr(this.router.url.lastIndexOf("/")+1);this.menus.forEach(e=>{e.selected=e.key===t}),this.title=this.menus.find(t=>t.selected).title}to(t){this.router.navigateByUrl(`/settings/personal/${t.key}`)}resize(){const t=this.el.nativeElement;let e="inline";const{offsetWidth:n}=t;n<641&&n>400&&(e="horizontal"),window.innerWidth<768&&n>400&&(e="horizontal"),this.mode=e,this.cdr.detectChanges()}ngAfterViewInit(){this.resize$=Object(K.a)(window,"resize").pipe(Object(D.a)(200)).subscribe(()=>this.resize())}ngOnDestroy(){this.resize$.unsubscribe(),this.router$.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(s.Qb(L.k),s.Qb(s.h),s.Qb(s.l))},t.\u0275cmp=s.Kb({type:t,selectors:[["app-settings-personal"]],decls:8,vars:3,consts:[[1,"main","ant-card-bordered"],[1,"menu"],["nz-menu","",3,"nzMode"],["nz-menu-item","",3,"nzSelected","click",4,"ngFor","ngForOf"],[1,"content"],[1,"title"],["nz-menu-item","",3,"nzSelected","click"]],template:function(t,e){1&t&&(s.Wb(0,"div",0),s.Wb(1,"div",1),s.Wb(2,"ul",2),s.Jc(3,$,2,2,"li",3),s.Vb(),s.Vb(),s.Wb(4,"div",4),s.Wb(5,"div",5),s.Lc(6),s.Vb(),s.Rb(7,"router-outlet"),s.Vb(),s.Vb()),2&t&&(s.Cb(2),s.oc("nzMode",e.mode),s.Cb(1),s.oc("ngForOf",e.menus),s.Cb(3),s.Mc(e.title))},directives:[A.c,g.n,L.o,h.a,A.e],styles:["[_nghost-%COMP%]{display:block;padding-top:24px}[_nghost-%COMP%]     .main{display:flex;width:100%;padding-top:16px;padding-bottom:16px;overflow:auto;background-color:#fff}[_nghost-%COMP%]     .menu{width:224px;border-right:1px solid #f0f0f0}[_nghost-%COMP%]     .menu .ant-menu-inline{border:none}[_nghost-%COMP%]     .menu .ant-menu:not(.ant-menu-horizontal) .ant-menu-item-selected{font-weight:700}[_nghost-%COMP%]     .content{flex:1;padding:8px 40px}[_nghost-%COMP%]     .content .title{margin-bottom:12px;color:#000000d9;font-weight:500;font-size:20px;line-height:28px}[_nghost-%COMP%]     .content .ant-list-split .ant-list-item:last-child{border-bottom:1px solid #e8e8e8}[_nghost-%COMP%]     .content .ant-list-item{padding-top:14px;padding-bottom:14px}@media screen and (max-width:767px){[_nghost-%COMP%]     .main{flex-direction:column}[_nghost-%COMP%]     .main .menu{width:100%;border:none}[_nghost-%COMP%]     .main .content{padding:40px}}[data-theme=dark]   [_nghost-%COMP%]     .main{background-color:#141414}[data-theme=dark]   [_nghost-%COMP%]     .content .title{color:#ffffffa6}[data-theme=dark]   [_nghost-%COMP%]     .menu{border-right-color:#303030}[data-theme=dark]   [_nghost-%COMP%]     .content .ant-list-split .ant-list-item:last-child{border-bottom-color:#303030}"],changeDetection:0}),t})();var j=n("EGpF");const E=[{path:"personal",component:N,children:[{path:"",redirectTo:"base",pathMatch:"full"},{path:"base",component:C},{path:"binding",component:S},{path:"password",component:J},{path:"report",component:(()=>{class t{constructor(t,e,n,i){this.http=t,this.titleSrv=e,this.msg=n,this.cdr=i,this.url="/api/users/settings",this.form={daily_report:!1,weekly_report:!1,monthly_report:!1}}ngOnInit(){this.titleSrv.setTitle("\u8bbe\u7f6e\u62a5\u544a"),this.load()}save(t){this.http.post(this.url,Object.assign({},t)).subscribe(t=>{0===t.code?(this.form=t.data,this.msg.success("\u66f4\u65b0\u6210\u529f")):this.msg.warning(t.message)})}load(){this.http.get(this.url).subscribe(t=>{0===t.code?(this.form=t.data,this.cdr.detectChanges()):this.msg.warning(t.message)})}}return t.\u0275fac=function(e){return new(e||t)(s.Qb(o.p),s.Qb(o.m),s.Qb(r.e),s.Qb(s.h))},t.\u0275cmp=s.Kb({type:t,selectors:[["app-settings-report"]],decls:12,vars:4,consts:[["nzType","warning","nzMessage","\u6ce8\u610f\uff01\u6b64\u529f\u80fd\u53ea\u4e3a Pro \u5e76\u4e14\u5df2\u7ecf\u7ed1\u5b9a Telegram \u7684\u7528\u6237\u4f7f\u7528"],["nz-form","","se-container","1","labelWidth","100",1,"pt-lg",3,"ngSubmit"],["f","ngForm"],["label","\u65e5\u62a5","extra","\u6bcf\u5929\u65e9\u4e0a 10 \u70b9\u62a5\u544a\u6628\u65e5\u6d88\u8d39\u6c47\u603b"],["nzCheckedChildren","\u5f00","nzUnCheckedChildren","\u5173","name","daily_report",3,"ngModel","ngModelChange"],["label","\u5468\u62a5","extra","\u6bcf\u5468\u4e00\u65e9\u4e0a 10 \u70b9\u62a5\u544a\u4e0a\u5468\u6d88\u8d39\u6c47\u603b"],["nzCheckedChildren","\u5f00","nzUnCheckedChildren","\u5173","name","weekly_report",3,"ngModel","ngModelChange"],["label","\u6708\u62a5","extra","\u6bcf\u6708 1 \u53f7\u65e9\u4e0a 10 \u70b9\u62a5\u544a\u4e0a\u4e2a\u6708\u6d88\u8d39\u6c47\u603b"],["nzCheckedChildren","\u5f00","nzUnCheckedChildren","\u5173","name","monthly_report",3,"ngModel","ngModelChange"],["col","1"],["nz-button","","nzType","primary",3,"disabled"]],template:function(t,e){if(1&t&&(s.Rb(0,"nz-alert",0),s.Wb(1,"form",1,2),s.dc("ngSubmit",function(){return e.save(e.form)}),s.Wb(3,"se",3),s.Wb(4,"nz-switch",4),s.dc("ngModelChange",function(t){return e.form.daily_report=t}),s.Vb(),s.Vb(),s.Wb(5,"se",5),s.Wb(6,"nz-switch",6),s.dc("ngModelChange",function(t){return e.form.weekly_report=t}),s.Vb(),s.Vb(),s.Wb(7,"se",7),s.Wb(8,"nz-switch",8),s.dc("ngModelChange",function(t){return e.form.monthly_report=t}),s.Vb(),s.Vb(),s.Wb(9,"se",9),s.Wb(10,"button",10),s.Lc(11,"\u4fdd\u5b58"),s.Vb(),s.Vb(),s.Vb()),2&t){const t=s.yc(2);s.Cb(4),s.oc("ngModel",e.form.daily_report),s.Cb(2),s.oc("ngModel",e.form.weekly_report),s.Cb(2),s.oc("ngModel",e.form.monthly_report),s.Cb(2),s.oc("disabled",t.invalid)}},directives:[a.a,c.u,c.n,c.o,l.b,b.b,b.a,j.a,c.m,c.p,m.a,u.a,h.a],encapsulation:2,changeDetection:0}),t})()}]}];let F=(()=>{class t{}return t.\u0275mod=s.Ob({type:t}),t.\u0275inj=s.Nb({factory:function(e){return new(e||t)},imports:[[L.n.forChild(E)],L.n]}),t})(),q=(()=>{class t{}return t.\u0275mod=s.Ob({type:t}),t.\u0275inj=s.Nb({factory:function(e){return new(e||t)},imports:[[i.b,F]]}),t})()}}]);