(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{yNfe:function(t,e,a){"use strict";a.r(e),a.d(e,"AnalysisModule",function(){return B});var n=a("M0ag"),c=a("tyNb"),i=a("2g7+"),o=a("QsJp"),s=a("ExrR"),r=a("NqGN"),d=a("fXoL"),b=a("Ac7g"),g=a("ofXK"),h=a("luDG"),l=a("PScX"),u=a("9H8w"),m=a("B+r4"),p=a("JA5x"),f=a("J09d"),y=a("oyxB"),z=a("NBwf"),D=a("DGaY"),x=a("rMZv");const C=["st"];function V(t,e){if(1&t&&(d.Ub(0),d.Rb(1,"g2-pie",11),d.hc(2,"_currency"),d.Tb()),2&t){const t=d.gc();d.Cb(1),d.oc("hasLegend",!0)("total",d.ic(2,4,t.pieData.total.expense))("valueFormat",t.handlePieValueFormat)("data",t.pieData.expense)}}function I(t,e){if(1&t&&(d.Ub(0),d.Rb(1,"g2-pie",12),d.hc(2,"_currency"),d.Tb()),2&t){const t=d.gc();d.Cb(1),d.oc("hasLegend",!0)("total",d.ic(2,4,t.pieData.total.income))("valueFormat",t.handlePieValueFormat)("data",t.pieData.income)}}function W(t,e){if(1&t&&d.Rb(0,"g2-bar",18),2&t){const t=d.gc().$implicit,e=d.gc(2);d.oc("title","\u652f\u51fa"+t.name)("data",e.recordSumData.expense)}}function _(t,e){if(1&t&&d.Rb(0,"g2-bar",18),2&t){const t=d.gc().$implicit,e=d.gc(2);d.oc("title","\u6536\u5165"+t.name)("data",e.recordSumData.income)}}function S(t,e){if(1&t&&(d.Wb(0,"nz-tab",15),d.Wb(1,"div",16),d.Ic(2,W,1,2,"g2-bar",17),d.Vb(),d.Wb(3,"div",16),d.Ic(4,_,1,2,"g2-bar",17),d.Vb(),d.Vb()),2&t){const t=e.$implicit,a=d.gc(2);d.oc("nzTitle",t.name),d.Cb(2),d.oc("ngIf",t.show&&a.recordSumData.expense.length),d.Cb(2),d.oc("ngIf",t.show&&a.recordSumData.income.length)}}function w(t,e){if(1&t){const t=d.Xb();d.Wb(0,"nz-tabset",13),d.dc("nzSelectedIndexChange",function(e){return d.Ac(t),d.gc().changeTab(e)}),d.Ic(1,S,5,3,"nz-tab",14),d.Vb()}if(2&t){const t=d.gc();d.Cb(1),d.oc("ngForOf",t.tabs)}}function q(t,e){if(1&t){const t=d.Xb();d.Wb(0,"a",23),d.dc("click",function(){d.Ac(t);const a=e.$implicit;return d.gc(2).open(a.category_id)}),d.Kc(1),d.Vb()}if(2&t){const t=e.$implicit;d.Cb(1),d.Lc(t.category_name)}}function L(t,e){if(1&t&&(d.Wb(0,"tr"),d.Wb(1,"td"),d.Wb(2,"strong"),d.Kc(3,"\u7ed3\u4f59"),d.Vb(),d.Vb(),d.Wb(4,"td",24),d.Wb(5,"strong"),d.Kc(6),d.hc(7,"_currency"),d.Vb(),d.Vb(),d.Vb()),2&t){const t=d.gc(3);d.Cb(6),d.Lc(d.ic(7,1,t.data.total.surplus))}}function v(t,e){if(1&t&&(d.Wb(0,"tr"),d.Wb(1,"td"),d.Wb(2,"strong"),d.Kc(3,"\u5408\u8ba1"),d.Vb(),d.Vb(),d.Wb(4,"td",24),d.Wb(5,"strong"),d.Kc(6),d.hc(7,"_currency"),d.Vb(),d.Vb(),d.Vb(),d.Ic(8,L,8,3,"tr",5)),2&t){const t=d.gc().$implicit,e=d.gc();d.Cb(6),d.Lc(d.ic(7,2,null==e.data?null:e.data.total[t])),d.Cb(2),d.oc("ngIf","income"===t)}}const O=function(){return{show:!1}};function F(t,e){if(1&t&&(d.Ub(0),d.Wb(1,"st",19,20),d.Ic(3,q,2,1,"ng-template",21),d.Ic(4,v,9,4,"ng-template",null,22,d.Jc),d.Vb(),d.Tb()),2&t){const t=e.$implicit,a=d.xc(5),n=d.gc();d.Cb(1),d.oc("data",n.data?n.data[t]:null)("loading",n.loading)("columns",n.columns)("page",d.rc(5,O))("body",a)}}const T=[{path:"index",component:(()=>{class t{constructor(t,e,a,n,c,i){this.http=t,this.cdr=e,this.datePipe=a,this.cache=n,this.modal=c,this.msg=i,this.isVisible=!1,this.q={},this.date=[],this.loading=!0,this.types=["expense","income"],this.columns=[{title:"\u5206\u7c7b",render:"custom"},{title:"\u91d1\u989d",type:"number",index:"currency_amount"}],this.tabs=[{key:"day",name:"\u65e5\u89c6\u56fe",show:!0},{key:"month",name:"\u6708\u89c6\u56fe"},{key:"year",name:"\u5e74\u89c6\u56fe"}]}ngOnInit(){this.date=Object(i.a)("month"),this.date&&(this.q.date=this.date.map(t=>this.datePipe.transform(t,"yyyy-MM-dd")).join("~")),this.q.ledger_id=this.cache.getNone(s.a.cacheKey.defaultIdLedger),this.getData(),this.getRecordSumData()}getData(){this.loading=!0;const t={};Object.entries(this.q).filter(([,t])=>null!==t).map(([e,a])=>t[e]=a),this.q=t,this.http.get("/api/analysis/category",this.q).subscribe(t=>{this.data=Object(o.b)(t.data),this.pieData=Object(o.b)(t.data),this.pieData.expense=this.pieData.expense.map(t=>({x:t.category_name,y:t.currency_amount})),this.pieData.income=this.pieData.income.map(t=>({x:t.category_name,y:t.currency_amount})),this.loading=!1,this.cdr.detectChanges()})}getRecordSumData(){const t={};Object.entries(this.q).filter(([,t])=>null!==t).map(([e,a])=>t[e]=a),this.q=t,this.http.get("/api/analysis/date",this.q).subscribe(t=>{this.recordSumData=t.data,this.recordSumData.expense=this.recordSumData.expense.map(t=>({x:t.date,y:t.currency_amount,color:"#f50"})),this.recordSumData.income=this.recordSumData.income.map(t=>({x:t.date,y:t.currency_amount})),this.cdr.detectChanges()})}reloadData(t){t&&(this.q.ledger_id=this.cache.getNone(s.a.cacheKey.defaultIdLedger),this.q=t,this.getData(),this.getRecordSumData())}changeTab(t){this.tabs[t].show=!0,this.q.group_type=this.tabs[t].key,this.getRecordSumData(),this.cdr.detectChanges()}handlePieValueFormat(t){return Object(n.c)(t)}open(t){this.q.category_id=t,this.q.pageSize=100,this.q.reimbursement_status="none,todo",this.q.exclude_from_stats="false",this.modal.create(r.a,{q:this.q},{size:"md"}).subscribe(t=>{})}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(b.p),d.Qb(d.h),d.Qb(g.f),d.Qb(h.a),d.Qb(b.j),d.Qb(l.e))},t.\u0275cmp=d.Kb({type:t,selectors:[["app-analysis-index"]],viewQuery:function(t,e){if(1&t&&d.Pc(C,1),2&t){let t;d.wc(t=d.ec())&&(e.st=t.first)}},decls:12,vars:12,consts:[[1,"pt-lg"],[3,"date","searched","reseted"],["nz-row","",3,"nzGutter"],["nz-col","","nzXs","24","nzSm","24","nzMd","24","nzLg","16"],["nzTitle","\u5206\u7c7b\u997c\u56fe",1,"mb-0",3,"nzLoading","nzBordered"],[4,"ngIf"],[1,"ant-card__body-nopadding","record-sum-card",3,"nzLoading","nzBordered"],[3,"nzSelectedIndexChange",4,"ngIf"],["nz-col","","nzXs","24","nzSm","24","nzMd","24","nzLg","8"],["nzTitle","\u5206\u7c7b\u7edf\u8ba1",1,"mb-0",3,"nzLoading","nzBordered"],[4,"ngFor","ngForOf"],["title","\u603b\u652f\u51fa","subTitle","\u603b\u652f\u51fa","height","295",3,"hasLegend","total","valueFormat","data"],["title","\u603b\u6536\u5165","subTitle","\u603b\u6536\u5165","height","295",3,"hasLegend","total","valueFormat","data"],[3,"nzSelectedIndexChange"],[3,"nzTitle",4,"ngFor","ngForOf"],[3,"nzTitle"],[1,"bar"],["height","295",3,"title","data",4,"ngIf"],["height","295",3,"title","data"],["size","middle",3,"data","loading","columns","page","body"],["st",""],["st-row","custom"],["body",""],[3,"click"],[1,"text-right"]],template:function(t,e){1&t&&(d.Wb(0,"div",0),d.Wb(1,"app-record-search",1),d.dc("searched",function(t){return e.reloadData(t)})("reseted",function(t){return e.reloadData(t)}),d.Vb(),d.Vb(),d.Wb(2,"div",2),d.Wb(3,"div",3),d.Wb(4,"nz-card",4),d.Ic(5,V,3,6,"ng-container",5),d.Ic(6,I,3,6,"ng-container",5),d.Vb(),d.Wb(7,"nz-card",6),d.Ic(8,w,2,1,"nz-tabset",7),d.Vb(),d.Vb(),d.Wb(9,"div",8),d.Wb(10,"nz-card",9),d.Ic(11,F,6,6,"ng-container",10),d.Vb(),d.Vb(),d.Vb()),2&t&&(d.Cb(1),d.oc("date",e.date),d.Cb(1),d.oc("nzGutter",24),d.Cb(2),d.oc("nzLoading",e.loading)("nzBordered",!1),d.Cb(1),d.oc("ngIf",!e.loading),d.Cb(1),d.oc("ngIf",!e.loading),d.Cb(1),d.oc("nzLoading",e.loading)("nzBordered",!1),d.Cb(1),d.oc("ngIf",e.recordSumData),d.Cb(2),d.oc("nzLoading",e.loading)("nzBordered",!1),d.Cb(1),d.oc("ngForOf",e.types))},directives:[u.a,m.c,m.a,p.a,g.o,g.n,f.a,y.b,y.a,z.a,D.a,D.c,x.l,x.b],pipes:[b.c],styles:["[_nghost-%COMP%]     .record-sum-card .bar{padding:0 24px 30px}[_nghost-%COMP%]     .record-sum-card .ant-tabs-nav-list{padding-left:24px}"]}),t})()}];let j=(()=>{class t{}return t.\u0275mod=d.Ob({type:t}),t.\u0275inj=d.Nb({factory:function(e){return new(e||t)},imports:[[c.n.forChild(T)],c.n]}),t})(),B=(()=>{class t{}return t.\u0275mod=d.Ob({type:t}),t.\u0275inj=d.Nb({factory:function(e){return new(e||t)},imports:[[n.b,j]]}),t})()}}]);