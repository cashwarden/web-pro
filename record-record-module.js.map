{"version":3,"sources":["./src/app/routes/record/record.module.ts","./src/app/routes/record/create-by-desc/create-by-desc.component.ts","./src/app/routes/record/create-by-desc/create-by-desc.component.html","./src/app/routes/record/index/index.component.ts","./src/app/routes/record/index/index.component.html","./src/app/routes/record/record-routing.module.ts","./src/app/routes/record/import/import.component.ts","./src/app/routes/record/import/import.component.html"],"names":[],"mappings":"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","file":"record-record-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { SharedModule } from '@shared';\nimport { RecordCreateByDescComponent } from './create-by-desc/create-by-desc.component';\nimport { RecordFormComponent } from './form/form.component';\nimport { RecordImportComponent } from './import/import.component';\nimport { RecordIndexComponent } from './index/index.component';\nimport { RecordRoutingModule } from './record-routing.module';\n\nconst COMPONENTS = [RecordIndexComponent];\nconst COMPONENTS_NOROUNT = [RecordFormComponent, RecordCreateByDescComponent, RecordImportComponent];\n\n@NgModule({\n  imports: [SharedModule, RecordRoutingModule],\n  declarations: [...COMPONENTS, ...COMPONENTS_NOROUNT],\n})\nexport class RecordModule {}\n","import { Component, EventEmitter, Output } from '@angular/core';\nimport { _HttpClient } from '@delon/theme';\nimport { NzMessageService } from 'ng-zorro-antd/message';\n\n@Component({\n  selector: 'app-record-create-by-desc',\n  templateUrl: './create-by-desc.component.html',\n})\nexport class RecordCreateByDescComponent {\n  @Output() created = new EventEmitter<{}>();\n\n  i: { description?: string } = {};\n\n  constructor(public msgSrv: NzMessageService, public http: _HttpClient) {}\n\n  submit() {\n    const data = { description: this.i.description };\n    this.http.post('/api/transactions/by-description', data).subscribe((res) => {\n      if (res.code !== 0) {\n        this.msgSrv.warning(res.message);\n        return;\n      }\n      this.msgSrv.success('添加成功');\n      this.i.description = '';\n      const q = { page: 1, pageSize: 50 };\n      this.created.emit(q);\n    });\n  }\n}\n","<form nz-form nzLayout=\"inline\" (ngSubmit)=\"submit()\" se-container>\n  <se label=\"快速记账\" error=\"最多120字\">\n    <input type=\"text\" nz-input [(ngModel)]=\"i.description\" name=\"description\" maxlength=\"120\" autocomplete=\"off\" />\n  </se>\n  <se>\n    <button nz-button nzType=\"primary\" [disabled]=\"!i.description\">提交</button>\n  </se>\n</form>\n","import { ChangeDetectorRef, Component, OnInit } from '@angular/core';\nimport { XlsxService } from '@delon/abc/xlsx';\nimport { CacheService } from '@delon/cache';\nimport { ModalHelper, _HttpClient } from '@delon/theme';\nimport format from 'date-fns/format';\nimport { Subject } from 'rxjs';\nimport { params } from 'src/app/shared/params';\nimport { RecordFormComponent } from '../form/form.component';\nimport { RecordImportComponent } from '../import/import.component';\n\n@Component({\n  selector: 'app-record-index',\n  styleUrls: ['./index.component.less'],\n  templateUrl: './index.component.html',\n})\nexport class RecordIndexComponent implements OnInit {\n  resetSubjectValue: Subject<boolean> = new Subject<boolean>();\n  q: any = {\n    page: 1,\n    pageSize: 50,\n  };\n  list: Array<{ date: string; records: []; in: string; out: string }> = [];\n  loading = true;\n\n  overview: [];\n  pagination: { totalCount: number; pageCount: number; currentPage: number; perPage: number };\n\n  constructor(\n    private http: _HttpClient,\n    private modal: ModalHelper,\n    private cdr: ChangeDetectorRef,\n    private xlsx: XlsxService,\n    private cache: CacheService,\n  ) { }\n\n  ngOnInit(): void {\n    this.q.ledger_id = this.cache.getNone(params.cacheKey.defaultIdLedger);\n  }\n\n  import(): void {\n    this.modal.create(RecordImportComponent, {}, { size: 'lg' }).subscribe(() => {\n      this.q.page = 1;\n      this.resetSubjectValue.next(this.q);\n      this.cdr.detectChanges();\n    });\n  }\n\n  form(record: { id?: number; transaction?: {} } = {}): void {\n    this.modal.create(RecordFormComponent, { record: record.transaction }, { size: 'md' }).subscribe(() => {\n      this.q.page = 1;\n      this.resetSubjectValue.next(this.q);\n      this.cdr.detectChanges();\n    });\n  }\n\n  download(): void {\n    const initData = [['账单日期', '类别', '类型', '金额', '标签', '描述', '备注', '账户 1', '账户 2']];\n    this.http.get('/api/transactions/export', { ledger_id: this.q.ledger_id, }).subscribe((res: any) => {\n      const data = initData.concat(res.data);\n      const now = format(new Date(), 'yyyy-MM-dd');\n      this.xlsx.export({\n        sheets: [\n          {\n            data,\n            name: 'sheet name',\n          },\n        ],\n        opts: {\n          bookType: 'csv',\n        },\n        filename: `CashWarden_Export_${now}.csv`,\n      });\n    });\n  }\n\n  reloadData(value) {\n    if (value) {\n      this.q.page = 1;\n      this.q.ledger_id = this.cache.getNone(params.cacheKey.defaultIdLedger);\n      this.q = value;\n      this.resetSubjectValue.next(this.q);\n    }\n  }\n}\n","<div class=\"pt-lg\">\n  <nz-card [nzBordered]=\"false\">\n    <div nz-row [nzGutter]=\"{ xs: 6, sm: 16, md: 24, lg: 32 }\">\n      <!-- <div nz-col>\n        <app-record-create-by-desc (created)=\"reloadData($event)\"></app-record-create-by-desc>\n      </div> -->\n      <div nz-col>\n        <button nz-button (click)=\"form()\" [nzType]=\"'default'\">\n          <i nz-icon nzType=\"plus\"></i>\n          <span>经典记账</span>\n        </button>\n      </div>\n      <div nz-col class=\"text-right\">\n        <nz-button-group>\n          <button nz-button (click)=\"import()\">导入</button>\n          <button nz-button (click)=\"download()\" nz-tooltip nzTooltipTitle=\"导出暂不包括「余额调整」类型记录\">导出</button>\n        </nz-button-group>\n      </div>\n    </div>\n  </nz-card>\n</div>\n\n<app-record-search (searched)=\"reloadData($event)\" (reseted)=\"reloadData($event)\" [q]=\"q\"></app-record-search>\n<nz-card [nzBordered]=\"false\">\n  <app-record-grid [q]=\"q\" [resetSubject]=\"resetSubjectValue\"></app-record-grid>\n</nz-card>\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { RecordIndexComponent } from './index/index.component';\n\nconst routes: Routes = [{ path: 'index', component: RecordIndexComponent }];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class RecordRoutingModule {}\n","import { Component, OnInit, ViewChild } from '@angular/core';\nimport { CacheService } from '@delon/cache';\nimport { _HttpClient } from '@delon/theme';\nimport { NzMessageService } from 'ng-zorro-antd/message';\nimport { NzModalRef } from 'ng-zorro-antd/modal';\nimport { NzUploadChangeParam } from 'ng-zorro-antd/upload';\nimport { params } from 'src/app/shared/params';\n\n@Component({\n  selector: 'app-record-import',\n  templateUrl: './import.component.html',\n})\nexport class RecordImportComponent {\n  url: string;\n  dataSet = [\n    { column_name: '账单日期', description: '消费时间, 常见的时间格式都支持，如：「2020-09-08 20:35」 「2020-09-08」', required: '是' },\n    { column_name: '类别', description: '账单类别，必须已经存在的分类', required: '是' },\n    { column_name: '类型', description: '账单类型，目前只有「支出」、「收入」、「转账」', required: '是' },\n    { column_name: '金额', description: '消费金额，整数或者最多两位小数', required: '是' },\n    { column_name: '标签', description: '多个标签用「/」分开', required: '否' },\n    { column_name: '描述', description: '账单描述', required: '否' },\n    { column_name: '备注', description: '账单备注', required: '否' },\n    {\n      column_name: '账户1',\n      description: '收入或者支出的账户，或者是转账类型的转出账户。如果为空，则使用默认账户，否则填写的账户必须已存在',\n      required: '否',\n    },\n    { column_name: '账户2', description: '转账类型时的转入账户', required: '交易类型为「转账」时必填' },\n  ];\n\n  constructor(private modal: NzModalRef, private msgSrv: NzMessageService, public http: _HttpClient, private cache: CacheService) {\n    const ledger_id = cache.getNone(params.cacheKey.defaultIdLedger);\n    this.url = `/api/transactions/upload?ledger_id=${ledger_id}`;\n  }\n\n  handleChange({ file, fileList }: NzUploadChangeParam): void {\n    const status = file.status;\n    if (status === 'done') {\n      if (file.response.code === 0) {\n        if (file.response.data.fail === 0) {\n          this.msgSrv.success(`${file.name} 导入成功`);\n        } else {\n          const error = file.response.data.fail_list[0];\n          this.msgSrv.error(`${file.name} 导入失败：[${error.data.toString()}] ${error.reason}`);\n        }\n      } else {\n        this.msgSrv.error(`${file.name} 导入失败：${file.response.message}`);\n      }\n    } else if (status === 'error') {\n      this.msgSrv.error(`${file.name} 文件上传失败`);\n    }\n  }\n\n  close() {\n    this.modal.destroy();\n  }\n}\n","<div class=\"modal-header\">\n  <div class=\"modal-title\">导入 CSV 文件</div>\n</div>\n<p>\n  <a down-file http-url=\"./assets/import-template.csv\" file-name=\"CashWarden导入模版.csv\"> 下载模版文件 </a>\n</p>\n\n<nz-collapse>\n  <nz-collapse-panel nzHeader=\"导入模版说明\" [nzActive]=\"false\">\n    <nz-table #basicTable [nzData]=\"dataSet\" nzSize=\"small\" [nzShowPagination]=\"false\">\n      <thead>\n        <tr>\n          <th>列名</th>\n          <th>描述</th>\n          <th>是否必须</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr *ngFor=\"let data of basicTable.data\">\n          <td>{{ data.column_name }}</td>\n          <td>{{ data.description }}</td>\n          <td>{{ data.required }}</td>\n        </tr>\n      </tbody>\n    </nz-table>\n  </nz-collapse-panel>\n</nz-collapse>\n\n<nz-upload nzType=\"drag\" [nzAction]=\"url\" nzAccept=\".csv\" (nzChange)=\"handleChange($event)\">\n  <p class=\"ant-upload-drag-icon\">\n    <i nz-icon nzType=\"inbox\"></i>\n  </p>\n  <p class=\"ant-upload-text\">点击或拖动文件到此区域上传</p>\n  <p class=\"ant-upload-hint\">支持多次上传，每次上传的文件要么全部失败，要么全部成功导入数据。</p>\n</nz-upload>\n"],"sourceRoot":"webpack:///"}