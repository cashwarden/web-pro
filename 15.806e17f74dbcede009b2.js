(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{AxMQ:function(e,t,n){"use strict";n.r(t),n.d(t,"RuleModule",function(){return Q});var o=n("M0ag"),a=n("tyNb"),i=n("fXoL"),c=n("dEAy"),s=n("PScX"),r=n("Ac7g"),l=n("3Pt+"),d=n("ocnv"),b=n("O3k0"),u=n("PTRe"),g=n("zAKX"),m=n("ofXK"),h=n("bE2y"),f=n("C2AL"),p=n("OzZK"),_=n("RwU8"),z=n("FwiY");function C(e,t){if(1&e&&i.Rb(0,"nz-option",37),2&e){const e=t.$implicit;i.oc("nzLabel",e.label)("nzValue",e.value)}}function V(e,t){if(1&e&&(i.Wb(0,"nz-option",38),i.Kc(1),i.Vb()),2&e){const e=t.$implicit;i.oc("nzLabel",e.name)("nzValue",e.id),i.Cb(1),i.Mc(" ",e.name," ")}}function y(e,t){if(1&e&&(i.Wb(0,"nz-option",38),i.Rb(1,"i",39),i.Kc(2),i.Vb()),2&e){const e=t.$implicit;i.oc("nzLabel",e.name)("nzValue",e.id),i.Cb(1),i.qc("nzIconfont","icon-",e.icon_name,""),i.Cb(1),i.Mc(" ",e.name," ")}}function M(e,t){if(1&e&&(i.Wb(0,"nz-option",38),i.Rb(1,"i",39),i.Kc(2),i.Vb()),2&e){const e=t.$implicit;i.oc("nzLabel",e.name)("nzValue",e.id),i.Cb(1),i.qc("nzIconfont","icon-",e.icon,""),i.Cb(1),i.Mc(" ",e.name," ")}}function W(e,t){if(1&e){const e=i.Xb();i.Wb(0,"se",40),i.Wb(1,"nz-select",41),i.dc("ngModelChange",function(t){return i.Ac(e),i.gc().form.then_from_account_id=t}),i.Ic(2,M,3,4,"nz-option",11),i.Vb(),i.Vb()}if(2&e){const e=i.gc();i.Cb(1),i.oc("ngModel",e.form.then_from_account_id),i.Cb(1),i.oc("ngForOf",e.selectData.account_id)}}function v(e,t){if(1&e&&(i.Wb(0,"nz-option",38),i.Rb(1,"i",39),i.Kc(2),i.Vb()),2&e){const e=t.$implicit;i.oc("nzLabel",e.name)("nzValue",e.id),i.Cb(1),i.qc("nzIconfont","icon-",e.icon,""),i.Cb(1),i.Mc(" ",e.name," ")}}function w(e,t){if(1&e){const e=i.Xb();i.Wb(0,"se",42),i.Wb(1,"nz-select",43),i.dc("ngModelChange",function(t){return i.Ac(e),i.gc().form.then_to_account_id=t}),i.Ic(2,v,3,4,"nz-option",11),i.Vb(),i.Vb()}if(2&e){const e=i.gc();i.Cb(1),i.oc("ngModel",e.form.then_to_account_id),i.Cb(1),i.oc("ngForOf",e.selectData.account_id)}}function D(e,t){if(1&e){const e=i.Xb();i.Wb(0,"nz-select",44),i.dc("ngModelChange",function(t){return i.Ac(e),i.gc().form.then_currency_code=t}),i.Rb(1,"nz-option",45),i.Vb()}if(2&e){const e=i.gc();i.oc("ngModel",e.form.then_currency_code)}}function x(e,t){if(1&e&&i.Rb(0,"nz-option",37),2&e){const e=t.$implicit;i.oc("nzLabel",e.value)("nzValue",e.value)}}const S=function(){return[]},k=function(){return["expense","transfer"]},I=function(){return["income","transfer"]};let K=(()=>{class e{constructor(e,t,n){this.modal=e,this.msgSrv=t,this.http=n,this.record={},this.selectData={},this.form={name:"",if_keywords:[],ledger_id:"",then_transaction_type:"expense",then_reimbursement_status:"none",then_from_account_id:"",then_to_account_id:"",then_category_id:"",then_tags:[],then_currency_amount:"",then_currency_code:"CNY",sort:99}}ngOnInit(){this.record.id&&(this.form=Object.assign({},this.record)),this.selectData.category_id=[]}changeTransactionType(){this.form.then_category_id="";const e=this.selectData.ledgersCategories.filter(e=>e.id===this.form.ledger_id)[0];e&&(this.selectData.category_id=e.categories[this.form.then_transaction_type])}save(e){this.http.request(this.record.id?"put":"post","/api/rules"+(this.record.id?`/${this.record.id}`:""),{body:e}).subscribe(e=>{0===e.code?(this.msgSrv.success("\u4fdd\u5b58\u6210\u529f"),this.modal.close(e.data)):this.msgSrv.warning(e.message)})}close(){this.modal.destroy()}}return e.\u0275fac=function(t){return new(t||e)(i.Qb(c.b),i.Qb(s.e),i.Qb(r.p))},e.\u0275cmp=i.Kb({type:e,selectors:[["app-rule-form"]],decls:55,vars:20,consts:[[1,"modal-header"],[1,"modal-title"],["nz-form","","se-container","1",3,"ngSubmit"],["f","ngForm"],["label","\u540d\u79f0"],["nz-input","","name","name","required","",3,"ngModel","ngModelChange"],["label","\u5173\u952e\u8bcd"],["nzMode","tags","name","if_keywords","required","",3,"ngModel","ngModelChange"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["label","\u5206\u914d\u8d26\u672c"],["name","ledger_id","required","",3,"ngModel","ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["label","\u5206\u914d\u4ea4\u6613\u7c7b\u578b"],["nzButtonStyle","solid","name","type",3,"ngModel","ngModelChange"],["nz-radio-button","","nzValue","expense"],["nz-radio-button","","nzValue","income"],["nz-radio-button","","nzValue","transfer"],["label","\u7c7b\u522b"],["name","category_id",3,"ngModel","ngModelChange"],["label","\u5206\u914d\u652f\u4ed8\u5e10\u6237",4,"ngIf"],["label","\u5206\u914d\u6536\u6b3e\u5e10\u6237",4,"ngIf"],["label","\u5206\u914d\u9ed8\u8ba4\u91d1\u989d"],[3,"nzAddOnAfter"],["nz-input","","type","number","name","then_currency_amount",3,"ngModel","ngModelChange"],["addOnAfterBtn",""],["label","\u5206\u914d\u6807\u7b7e"],["nzMode","tags","name","then_tags",3,"ngModel","ngModelChange"],["label","\u5206\u914d\u62a5\u9500\u72b6\u6001"],["nzButtonStyle","solid","name","then_reimbursement_status",3,"ngModel","ngModelChange"],["nz-radio-button","","nzValue","none"],["nz-radio-button","","nzValue","todo"],["nz-radio-button","","nzValue","done"],["label","\u6392\u5e8f"],["nz-input","","type","number","name","sort","required","",3,"ngModel","ngModelChange"],["col","1"],["nz-button","","type","button",3,"click"],["nz-button","","nzType","primary",3,"disabled"],[3,"nzLabel","nzValue"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon","",3,"nzIconfont"],["label","\u5206\u914d\u652f\u4ed8\u5e10\u6237"],["name","from_account_id",3,"ngModel","ngModelChange"],["label","\u5206\u914d\u6536\u6b3e\u5e10\u6237"],["name","to_account_id",3,"ngModel","ngModelChange"],["name","then_currency_code",2,"width","80px",3,"ngModel","ngModelChange"],["nzLabel","CNY","nzValue","CNY"]],template:function(e,t){if(1&e&&(i.Wb(0,"div",0),i.Wb(1,"div",1),i.Kc(2,"\u7f16\u8f91\u89c4\u5219"),i.Vb(),i.Vb(),i.Wb(3,"form",2,3),i.dc("ngSubmit",function(){return t.save(t.form)}),i.Wb(5,"se",4),i.Wb(6,"input",5),i.dc("ngModelChange",function(e){return t.form.name=e}),i.Vb(),i.Vb(),i.Wb(7,"se",6),i.Wb(8,"nz-select",7),i.dc("ngModelChange",function(e){return t.form.if_keywords=e}),i.Ic(9,C,1,2,"nz-option",8),i.Vb(),i.Vb(),i.Wb(10,"se",9),i.Wb(11,"nz-select",10),i.dc("ngModelChange",function(e){return t.form.ledger_id=e})("ngModelChange",function(){return t.changeTransactionType()}),i.Ic(12,V,2,3,"nz-option",11),i.Vb(),i.Vb(),i.Wb(13,"se",12),i.Wb(14,"nz-radio-group",13),i.dc("ngModelChange",function(e){return t.form.then_transaction_type=e})("ngModelChange",function(){return t.changeTransactionType()}),i.Wb(15,"label",14),i.Wb(16,"span"),i.Kc(17,"\u652f\u51fa"),i.Vb(),i.Vb(),i.Wb(18,"label",15),i.Wb(19,"span"),i.Kc(20,"\u6536\u5165"),i.Vb(),i.Vb(),i.Wb(21,"label",16),i.Wb(22,"span"),i.Kc(23,"\u8f6c\u8d26"),i.Vb(),i.Vb(),i.Vb(),i.Vb(),i.Wb(24,"se",17),i.Wb(25,"nz-select",18),i.dc("ngModelChange",function(e){return t.form.then_category_id=e}),i.Ic(26,y,3,4,"nz-option",11),i.Vb(),i.Vb(),i.Ic(27,W,3,2,"se",19),i.Ic(28,w,3,2,"se",20),i.Wb(29,"se",21),i.Wb(30,"nz-input-group",22),i.Wb(31,"input",23),i.dc("ngModelChange",function(e){return t.form.then_currency_amount=e}),i.Vb(),i.Ic(32,D,2,1,"ng-template",null,24,i.Jc),i.Vb(),i.Vb(),i.Wb(34,"se",25),i.Wb(35,"nz-select",26),i.dc("ngModelChange",function(e){return t.form.then_tags=e}),i.Ic(36,x,1,2,"nz-option",8),i.Vb(),i.Vb(),i.Wb(37,"se",27),i.Wb(38,"nz-radio-group",28),i.dc("ngModelChange",function(e){return t.form.then_reimbursement_status=e}),i.Wb(39,"label",29),i.Wb(40,"span"),i.Kc(41,"\u4e0d\u9700\u8981"),i.Vb(),i.Vb(),i.Wb(42,"label",30),i.Wb(43,"span"),i.Kc(44,"\u5f85\u62a5\u9500"),i.Vb(),i.Vb(),i.Wb(45,"label",31),i.Wb(46,"span"),i.Kc(47,"\u5df2\u62a5\u9500"),i.Vb(),i.Vb(),i.Vb(),i.Vb(),i.Wb(48,"se",32),i.Wb(49,"input",33),i.dc("ngModelChange",function(e){return t.form.sort=e}),i.Vb(),i.Vb(),i.Wb(50,"se",34),i.Wb(51,"button",35),i.dc("click",function(){return t.close()}),i.Kc(52,"\u5173\u95ed"),i.Vb(),i.Wb(53,"button",36),i.Kc(54,"\u4fdd\u5b58"),i.Vb(),i.Vb(),i.Vb()),2&e){const e=i.xc(4),n=i.xc(33);i.Cb(6),i.oc("ngModel",t.form.name),i.Cb(2),i.oc("ngModel",t.form.if_keywords),i.Cb(1),i.oc("ngForOf",i.rc(17,S)),i.Cb(2),i.oc("ngModel",t.form.ledger_id),i.Cb(1),i.oc("ngForOf",t.selectData.ledgersCategories),i.Cb(2),i.oc("ngModel",t.form.then_transaction_type),i.Cb(11),i.oc("ngModel",t.form.then_category_id),i.Cb(1),i.oc("ngForOf",t.selectData.category_id),i.Cb(1),i.oc("ngIf",i.rc(18,k).includes(t.form.then_transaction_type)),i.Cb(1),i.oc("ngIf",i.rc(19,I).includes(t.form.then_transaction_type)),i.Cb(2),i.oc("nzAddOnAfter",n),i.Cb(1),i.oc("ngModel",t.form.then_currency_amount),i.Cb(4),i.oc("ngModel",t.form.then_tags),i.Cb(1),i.oc("ngForOf",t.selectData.tags),i.Cb(2),i.oc("ngModel",t.form.then_reimbursement_status),i.Cb(11),i.oc("ngModel",t.form.sort),i.Cb(4),i.oc("disabled",e.invalid)}},directives:[l.u,l.n,l.o,d.b,b.b,b.a,u.b,l.d,l.s,l.m,l.p,g.e,m.n,h.c,h.b,h.a,m.o,f.a,u.c,l.q,p.a,_.a,g.a,z.a],encapsulation:2}),e})();var O=n("JA5x"),L=n("B+r4"),A=n("ok2U"),q=n("DGaY");const R=["st"],F=function(){return{xs:6,sm:16,md:24,lg:32}},T=[{path:"index",component:(()=>{class e{constructor(e,t,n){this.http=e,this.modal=t,this.message=n,this.loading=!0,this.list=[],this.selectData={},this.q={page:1,pageSize:100,name:""},this.searchSchema={properties:{name:{type:"string",title:"\u540d\u79f0"}}},this.columns=[{title:"\u540d\u79f0 ",index:"name"},{title:"\u5173\u952e\u8bcd",index:"if_keywords"},{title:"\u8d26\u672c",index:"ledger.name"},{title:"\u5206\u914d\u4ea4\u6613\u7c7b\u578b",index:"then_transaction_type_text"},{title:"\u5206\u914d\u7c7b\u522b",index:"thenCategory.name"},{title:"\u6392\u5e8f",index:"sort"},{title:"\u72b6\u6001",type:"badge",index:"status",badge:{active:{text:"\u542f\u7528",color:"success"},unactivated:{text:"\u505c\u7528",color:"default"}}},{title:"\u65f6\u95f4",type:"date",index:"updated_at"},{title:"",buttons:[{icon:"edit",type:"modal",click:e=>this.form(e)},{icon:"copy",type:"modal",click:e=>this.copy(e)},{icon:"play-circle",click:e=>this.updateStatus(e,"active"),iif:e=>"unactivated"===e.status,tooltip:"\u542f\u7528"},{icon:"pause-circle",click:e=>this.updateStatus(e,"unactivated"),iif:e=>"active"===e.status,tooltip:"\u505c\u7528"},{icon:"delete",type:"del",pop:{title:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",okType:"danger"},click:(e,t,n)=>{this.delete(e),n.removeRow(e)}}]}]}ngOnInit(){this.getData(),this.loadSelect("/api/accounts","account_id"),this.getLedgersCategories(),this.loadSelect("/api/tags","tags")}getData(){this.loading=!0,this.http.get("/api/rules",this.q).subscribe(e=>{this.list=e.data.items,this.pagination=e.data._meta,this.loading=!1})}form(e={}){this.modal.create(K,{record:e,selectData:this.selectData},{size:"md"}).subscribe(e=>{this.getData()})}copy(e){this.http.post(`/api/rules/${e.id}/copy`).subscribe(e=>{0===(null==e?void 0:e.code)?(this.list.splice(0,0,e.data),this.list=[...this.list],this.message.success("\u590d\u5236\u6210\u529f")):this.message.warning(null==e?void 0:e.message)})}delete(e){this.http.delete(`/api/rules/${e.id}`).subscribe(e=>{0===(null==e?void 0:e.code)?this.message.success("\u5220\u9664\u6210\u529f"):this.message.warning(null==e?void 0:e.message)})}updateStatus(e,t){this.http.put(`/api/rules/${e.id}/status`,{status:t}).subscribe(e=>{0===(null==e?void 0:e.code)?(this.getData(),this.message.success("\u66f4\u65b0\u6210\u529f")):this.message.warning(null==e?void 0:e.message)})}loadSelect(e,t){this.http.get(e,{pageSize:50}).subscribe(e=>{e.data&&("tags"===t?this.selectData[t]=e.data.items.map(e=>({value:e.name,label:e.name})):["account_id","category_id"].includes(t)?this.selectData[t]=e.data.items.map(e=>({id:e.id,name:e.name,icon:e.icon_name})):"transaction_type"===t&&(this.selectData[t]=e.data.map(e=>({value:e.type,label:e.name}))))})}getLedgersCategories(){this.http.get("/api/ledgers/categories").subscribe(e=>{this.selectData.ledgersCategories=e.data})}submit(e){e.name&&(this.q.name=e.name,this.getData())}reset(){this.q.name="",this.getData()}}return e.\u0275fac=function(t){return new(t||e)(i.Qb(r.p),i.Qb(r.j),i.Qb(s.e))},e.\u0275cmp=i.Kb({type:e,selectors:[["app-rule-index"]],viewQuery:function(e,t){if(1&e&&i.Pc(R,1),2&e){let e;i.wc(e=i.ec())&&(t.st=e.first)}},decls:11,vars:5,consts:[[1,"pt-lg"],["nz-row","",3,"nzGutter"],["nz-col",""],["mode","search",3,"schema","formSubmit","formReset"],["nz-button","","nzType","primary",3,"click"],[3,"data","columns"],["st",""]],template:function(e,t){1&e&&(i.Wb(0,"div",0),i.Wb(1,"nz-card"),i.Wb(2,"div",1),i.Wb(3,"div",2),i.Wb(4,"sf",3),i.dc("formSubmit",function(e){return t.submit(e)})("formReset",function(){return t.reset()}),i.Vb(),i.Vb(),i.Wb(5,"div",2),i.Wb(6,"button",4),i.dc("click",function(){return t.form()}),i.Kc(7,"\u65b0\u5efa"),i.Vb(),i.Vb(),i.Vb(),i.Vb(),i.Vb(),i.Wb(8,"nz-card"),i.Rb(9,"st",5,6),i.Vb()),2&e&&(i.Cb(2),i.oc("nzGutter",i.rc(4,F)),i.Cb(2),i.oc("schema",t.searchSchema),i.Cb(5),i.oc("data",t.list)("columns",t.columns))},directives:[O.a,L.c,L.a,A.b,p.a,_.a,f.a,q.a],encapsulation:2}),e})()}];let $=(()=>{class e{}return e.\u0275mod=i.Ob({type:e}),e.\u0275inj=i.Nb({factory:function(t){return new(t||e)},imports:[[a.n.forChild(T)],a.n]}),e})(),Q=(()=>{class e{}return e.\u0275mod=i.Ob({type:e}),e.\u0275inj=i.Nb({factory:function(t){return new(t||e)},imports:[[o.b,$]]}),e})()}}]);